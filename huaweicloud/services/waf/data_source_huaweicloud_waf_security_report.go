// Generated by PMS #1010
package waf

import (
	"context"
	"strings"

	"github.com/hashicorp/go-multierror"
	"github.com/hashicorp/go-uuid"
	"github.com/hashicorp/terraform-plugin-sdk/v2/diag"
	"github.com/hashicorp/terraform-plugin-sdk/v2/helper/schema"
	"github.com/tidwall/gjson"

	"github.com/huaweicloud/terraform-provider-huaweicloud/huaweicloud/config"
	"github.com/huaweicloud/terraform-provider-huaweicloud/huaweicloud/helper/httphelper"
	"github.com/huaweicloud/terraform-provider-huaweicloud/huaweicloud/helper/schemas"
	"github.com/huaweicloud/terraform-provider-huaweicloud/huaweicloud/utils"
)

func DataSourceWafSecurityReport() *schema.Resource {
	return &schema.Resource{
		ReadContext: dataSourceWafSecurityReportRead,

		Schema: map[string]*schema.Schema{
			"region": {
				Type:     schema.TypeString,
				Optional: true,
				Computed: true,
			},
			"report_id": {
				Type:     schema.TypeString,
				Required: true,
			},
			"subscription_id": {
				Type:     schema.TypeString,
				Required: true,
			},
			"sending_period": {
				Type:     schema.TypeString,
				Computed: true,
			},
			"report_name": {
				Type:     schema.TypeString,
				Computed: true,
			},
			"topic_urn": {
				Type:     schema.TypeString,
				Computed: true,
			},
			"subscription_type": {
				Type:     schema.TypeString,
				Computed: true,
			},
			"stat_period": {
				Type:     schema.TypeList,
				Computed: true,
				Elem: &schema.Resource{
					Schema: map[string]*schema.Schema{
						"begin_time": {
							Type:     schema.TypeInt,
							Computed: true,
						},
						"end_time": {
							Type:     schema.TypeInt,
							Computed: true,
						},
					},
				},
			},
			"report_category": {
				Type:     schema.TypeString,
				Computed: true,
			},
			"report_content_info": {
				Type:     schema.TypeList,
				Computed: true,
				Elem: &schema.Resource{
					Schema: map[string]*schema.Schema{
						"request_statistics_info_list": {
							Type:     schema.TypeList,
							Computed: true,
							Elem: &schema.Resource{
								Schema: map[string]*schema.Schema{
									"key": {
										Type:     schema.TypeString,
										Computed: true,
									},
									"timeline": {
										Type:     schema.TypeList,
										Computed: true,
										Elem:     repConInfReqStaInfLisTimelineElem(),
									},
								},
							},
						},
						"bandwidth_statistics_info": {
							Type:     schema.TypeList,
							Computed: true,
							Elem: &schema.Resource{
								Schema: map[string]*schema.Schema{
									"average_info_list": {
										Type:     schema.TypeList,
										Computed: true,
										Elem:     repConInfBanStaInfAveInfListElem(),
									},
									"peak_info_list": {
										Type:     schema.TypeList,
										Computed: true,
										Elem:     repConInfBanStaInfPeaInfListElem(),
									},
								},
							},
						},
						"response_code_statistics_info": {
							Type:     schema.TypeList,
							Computed: true,
							Elem: &schema.Resource{
								Schema: map[string]*schema.Schema{
									"response_source_waf_info_list": {
										Type:     schema.TypeList,
										Computed: true,
										Elem:     rcircsirswilElem(),
									},
									"response_source_upstream_info_list": {
										Type:     schema.TypeList,
										Computed: true,
										Elem:     rcircsirsuilElem(),
									},
								},
							},
						},
						"attack_type_distribution_info_list": {
							Type:     schema.TypeList,
							Computed: true,
							Elem: &schema.Resource{
								Schema: map[string]*schema.Schema{
									"key": {
										Type:     schema.TypeString,
										Computed: true,
									},
									"num": {
										Type:     schema.TypeInt,
										Computed: true,
									},
								},
							},
						},
						"top_attacked_urls_info_list": {
							Type:     schema.TypeList,
							Computed: true,
							Elem: &schema.Resource{
								Schema: map[string]*schema.Schema{
									"key": {
										Type:     schema.TypeString,
										Computed: true,
									},
									"num": {
										Type:     schema.TypeInt,
										Computed: true,
									},
									"host": {
										Type:     schema.TypeString,
										Computed: true,
									},
								},
							},
						},
						"qps_statistics_info": {
							Type:     schema.TypeList,
							Computed: true,
							Elem: &schema.Resource{
								Schema: map[string]*schema.Schema{
									"average_info_list": {
										Type:     schema.TypeList,
										Computed: true,
										Elem:     repConInfQPSStaInfAveInfListElem(),
									},
									"peak_info_list": {
										Type:     schema.TypeList,
										Computed: true,
										Elem:     repConInfQPSStaInfPeaInfListElem(),
									},
								},
							},
						},
						"top_attacked_domains_info_list": {
							Type:     schema.TypeList,
							Computed: true,
							Elem: &schema.Resource{
								Schema: map[string]*schema.Schema{
									"key": {
										Type:     schema.TypeString,
										Computed: true,
									},
									"num": {
										Type:     schema.TypeInt,
										Computed: true,
									},
									"web_tag": {
										Type:     schema.TypeString,
										Computed: true,
									},
								},
							},
						},
						"top_attack_source_ips_info_list": {
							Type:     schema.TypeList,
							Computed: true,
							Elem: &schema.Resource{
								Schema: map[string]*schema.Schema{
									"key": {
										Type:     schema.TypeString,
										Computed: true,
									},
									"num": {
										Type:     schema.TypeInt,
										Computed: true,
									},
								},
							},
						},
						"top_attack_source_locations_info_list": {
							Type:     schema.TypeList,
							Computed: true,
							Elem: &schema.Resource{
								Schema: map[string]*schema.Schema{
									"key": {
										Type:     schema.TypeString,
										Computed: true,
									},
									"num": {
										Type:     schema.TypeInt,
										Computed: true,
									},
								},
							},
						},
						"top_abnormal_urls_info": {
							Type:     schema.TypeList,
							Computed: true,
							Elem: &schema.Resource{
								Schema: map[string]*schema.Schema{
									"abnormal_502_info_list": {
										Type:     schema.TypeList,
										Computed: true,
										Elem:     rcitauiailElem(),
									},
									"abnormal_500_info_list": {
										Type:     schema.TypeList,
										Computed: true,
										Elem:     rcitauiailElem(),
									},
									"abnormal_404_info_list": {
										Type:     schema.TypeList,
										Computed: true,
										Elem:     rcitauiailElem(),
									},
								},
							},
						},
						"overview_statistics_list_info": {
							Type:     schema.TypeList,
							Computed: true,
							Elem: &schema.Resource{
								Schema: map[string]*schema.Schema{
									"key": {
										Type:     schema.TypeString,
										Computed: true,
									},
									"num": {
										Type:     schema.TypeInt,
										Computed: true,
									},
									"top_domains": {
										Type:     schema.TypeList,
										Computed: true,
										Elem:     rcioslitdElem(),
									},
								},
							},
						},
					},
				},
			},
			"create_time": {
				Type:     schema.TypeInt,
				Computed: true,
			},
		},
	}
}

// rcioslitdElem
// The Elem of "report_content_info.overview_statistics_list_info.top_domains"
func rcioslitdElem() *schema.Resource {
	return &schema.Resource{
		Schema: map[string]*schema.Schema{
			"num": {
				Type:     schema.TypeInt,
				Computed: true,
			},
			"host": {
				Type:     schema.TypeString,
				Computed: true,
			},
		},
	}
}

// repConInfReqStaInfLisTimelineElem
// The Elem of "report_content_info.request_statistics_info_list.timeline"
func repConInfReqStaInfLisTimelineElem() *schema.Resource {
	return &schema.Resource{
		Schema: map[string]*schema.Schema{
			"time": {
				Type:     schema.TypeInt,
				Computed: true,
			},
			"num": {
				Type:     schema.TypeInt,
				Computed: true,
			},
		},
	}
}

// repConInfBanStaInfAveInfListElem
// The Elem of "report_content_info.bandwidth_statistics_info.average_info_list"
func repConInfBanStaInfAveInfListElem() *schema.Resource {
	return &schema.Resource{
		Schema: map[string]*schema.Schema{
			"key": {
				Type:     schema.TypeString,
				Computed: true,
			},
			"timeline": {
				Type:     schema.TypeList,
				Computed: true,
				Elem: &schema.Resource{
					Schema: map[string]*schema.Schema{
						"num": {
							Type:     schema.TypeInt,
							Computed: true,
						},
						"time": {
							Type:     schema.TypeInt,
							Computed: true,
						},
					},
				},
			},
		},
	}
}

// rcircsirsuilElem
// The Elem of "report_content_info.response_code_statistics_info.response_source_upstream_info_list"
func rcircsirsuilElem() *schema.Resource {
	return &schema.Resource{
		Schema: map[string]*schema.Schema{
			"key": {
				Type:     schema.TypeString,
				Computed: true,
			},
			"timeline": {
				Type:     schema.TypeList,
				Computed: true,
				Elem: &schema.Resource{
					Schema: map[string]*schema.Schema{
						"time": {
							Type:     schema.TypeInt,
							Computed: true,
						},
						"num": {
							Type:     schema.TypeInt,
							Computed: true,
						},
					},
				},
			},
		},
	}
}

// repConInfQPSStaInfAveInfListElem
// The Elem of "report_content_info.qps_statistics_info.average_info_list"
func repConInfQPSStaInfAveInfListElem() *schema.Resource {
	return &schema.Resource{
		Schema: map[string]*schema.Schema{
			"key": {
				Type:     schema.TypeString,
				Computed: true,
			},
			"timeline": {
				Type:     schema.TypeList,
				Computed: true,
				Elem: &schema.Resource{
					Schema: map[string]*schema.Schema{
						"time": {
							Type:     schema.TypeInt,
							Computed: true,
						},
						"num": {
							Type:     schema.TypeInt,
							Computed: true,
						},
					},
				},
			},
		},
	}
}

// repConInfBanStaInfPeaInfListElem
// The Elem of "report_content_info.bandwidth_statistics_info.peak_info_list"
func repConInfBanStaInfPeaInfListElem() *schema.Resource {
	return &schema.Resource{
		Schema: map[string]*schema.Schema{
			"key": {
				Type:     schema.TypeString,
				Computed: true,
			},
			"timeline": {
				Type:     schema.TypeList,
				Computed: true,
				Elem: &schema.Resource{
					Schema: map[string]*schema.Schema{
						"time": {
							Type:     schema.TypeInt,
							Computed: true,
						},
						"num": {
							Type:     schema.TypeInt,
							Computed: true,
						},
					},
				},
			},
		},
	}
}

// rcircsirswilElem
// The Elem of "report_content_info.response_code_statistics_info.response_source_waf_info_list"
func rcircsirswilElem() *schema.Resource {
	return &schema.Resource{
		Schema: map[string]*schema.Schema{
			"key": {
				Type:     schema.TypeString,
				Computed: true,
			},
			"timeline": {
				Type:     schema.TypeList,
				Computed: true,
				Elem: &schema.Resource{
					Schema: map[string]*schema.Schema{
						"time": {
							Type:     schema.TypeInt,
							Computed: true,
						},
						"num": {
							Type:     schema.TypeInt,
							Computed: true,
						},
					},
				},
			},
		},
	}
}

// repConInfQPSStaInfPeaInfListElem
// The Elem of "report_content_info.qps_statistics_info.peak_info_list"
func repConInfQPSStaInfPeaInfListElem() *schema.Resource {
	return &schema.Resource{
		Schema: map[string]*schema.Schema{
			"key": {
				Type:     schema.TypeString,
				Computed: true,
			},
			"timeline": {
				Type:     schema.TypeList,
				Computed: true,
				Elem: &schema.Resource{
					Schema: map[string]*schema.Schema{
						"time": {
							Type:     schema.TypeInt,
							Computed: true,
						},
						"num": {
							Type:     schema.TypeInt,
							Computed: true,
						},
					},
				},
			},
		},
	}
}

// rcitauiailElem
// The Elem of "report_content_info.top_abnormal_urls_info.abnormal_502_info_list",
// "report_content_info.top_abnormal_urls_info.abnormal_500_info_list",
// "report_content_info.top_abnormal_urls_info.abnormal_404_info_list".
func rcitauiailElem() *schema.Resource {
	return &schema.Resource{
		Schema: map[string]*schema.Schema{
			"key": {
				Type:     schema.TypeString,
				Computed: true,
			},
			"num": {
				Type:     schema.TypeInt,
				Computed: true,
			},
			"host": {
				Type:     schema.TypeString,
				Computed: true,
			},
		},
	}
}

type SecurityReportDSWrapper struct {
	*schemas.ResourceDataWrapper
	Config *config.Config
}

func newSecurityReportDSWrapper(d *schema.ResourceData, meta interface{}) *SecurityReportDSWrapper {
	return &SecurityReportDSWrapper{
		ResourceDataWrapper: schemas.NewSchemaWrapper(d),
		Config:              meta.(*config.Config),
	}
}

func dataSourceWafSecurityReportRead(_ context.Context, d *schema.ResourceData, meta interface{}) diag.Diagnostics {
	wrapper := newSecurityReportDSWrapper(d, meta)
	shoSecRepConRst, err := wrapper.ShowSecurityReportContent()
	if err != nil {
		return diag.FromErr(err)
	}

	id, err := uuid.GenerateUUID()
	if err != nil {
		return diag.FromErr(err)
	}
	d.SetId(id)

	err = wrapper.showSecurityReportContentToSchema(shoSecRepConRst)
	if err != nil {
		return diag.FromErr(err)
	}

	return nil
}

// @API WAF GET /v1/{project_id}/waf/security-reports/{report_id}
func (w *SecurityReportDSWrapper) ShowSecurityReportContent() (*gjson.Result, error) {
	client, err := w.NewClient(w.Config, "waf")
	if err != nil {
		return nil, err
	}

	uri := "/v1/{project_id}/waf/security-reports/{report_id}"
	uri = strings.ReplaceAll(uri, "{report_id}", w.Get("report_id").(string))
	params := map[string]any{
		"subscription_id": w.Get("subscription_id"),
	}
	params = utils.RemoveNil(params)
	return httphelper.New(client).
		Method("GET").
		URI(uri).
		Query(params).
		Request().
		Result()
}

func (w *SecurityReportDSWrapper) showSecurityReportContentToSchema(body *gjson.Result) error {
	d := w.ResourceData
	mErr := multierror.Append(nil,
		d.Set("region", w.Config.GetRegion(w.ResourceData)),
		d.Set("sending_period", body.Get("sending_period").Value()),
		d.Set("report_name", body.Get("report_name").Value()),
		d.Set("topic_urn", body.Get("topic_urn").Value()),
		d.Set("subscription_type", body.Get("subscription_type").Value()),
		d.Set("stat_period", schemas.ObjectToList(body.Get("stat_period"),
			func(statPeriod gjson.Result) any {
				return map[string]any{
					"begin_time": statPeriod.Get("begin_time").Value(),
					"end_time":   statPeriod.Get("end_time").Value(),
				}
			},
		)),
		d.Set("report_category", body.Get("report_category").Value()),
		d.Set("report_content_info", schemas.ObjectToList(body.Get("report_content_info"),
			func(repConInfo gjson.Result) any {
				return map[string]any{
					"request_statistics_info_list": schemas.SliceToList(repConInfo.Get("request_statistics_info_list"),
						func(reqStaInfList gjson.Result) any {
							return map[string]any{
								"key":      reqStaInfList.Get("key").Value(),
								"timeline": w.setRcirsilt(reqStaInfList),
							}
						},
					),
					"bandwidth_statistics_info": schemas.SliceToList(repConInfo.Get("bandwidth_statistics_info"),
						func(banStaInfo gjson.Result) any {
							return map[string]any{
								"average_info_list": w.setRcibsiail(banStaInfo),
								"peak_info_list":    w.setRcibsipil(banStaInfo),
							}
						},
					),
					"response_code_statistics_info": schemas.SliceToList(repConInfo.Get("response_code_statistics_info"),
						func(resCodStaInfo gjson.Result) any {
							return map[string]any{
								"response_source_waf_info_list":      w.setRcircsirswil(resCodStaInfo),
								"response_source_upstream_info_list": w.setRcircsirsuil(resCodStaInfo),
							}
						},
					),
					"attack_type_distribution_info_list": schemas.SliceToList(repConInfo.Get("attack_type_distribution_info_list"),
						func(attTypDisInfList gjson.Result) any {
							return map[string]any{
								"key": attTypDisInfList.Get("key").Value(),
								"num": attTypDisInfList.Get("num").Value(),
							}
						},
					),
					"top_attacked_urls_info_list": schemas.SliceToList(repConInfo.Get("top_attacked_urls_info_list"),
						func(topAttUrlInfList gjson.Result) any {
							return map[string]any{
								"key":  topAttUrlInfList.Get("key").Value(),
								"num":  topAttUrlInfList.Get("num").Value(),
								"host": topAttUrlInfList.Get("host").Value(),
							}
						},
					),
					"qps_statistics_info": schemas.SliceToList(repConInfo.Get("qps_statistics_info"),
						func(qpsStatisticsInfo gjson.Result) any {
							return map[string]any{
								"average_info_list": w.setRciqsiail(qpsStatisticsInfo),
								"peak_info_list":    w.setRciqsipil(qpsStatisticsInfo),
							}
						},
					),
					"top_attacked_domains_info_list": schemas.SliceToList(repConInfo.Get("top_attacked_domains_info_list"),
						func(topAttDomInfList gjson.Result) any {
							return map[string]any{
								"key":     topAttDomInfList.Get("key").Value(),
								"num":     topAttDomInfList.Get("num").Value(),
								"web_tag": topAttDomInfList.Get("web_tag").Value(),
							}
						},
					),
					"top_attack_source_ips_info_list": schemas.SliceToList(repConInfo.Get("top_attack_source_ips_info_list"),
						func(topAttSouIpsInfList gjson.Result) any {
							return map[string]any{
								"key": topAttSouIpsInfList.Get("key").Value(),
								"num": topAttSouIpsInfList.Get("num").Value(),
							}
						},
					),
					"top_attack_source_locations_info_list": schemas.SliceToList(repConInfo.Get("top_attack_source_locations_info_list"),
						func(topAttSouLocInfList gjson.Result) any {
							return map[string]any{
								"key": topAttSouLocInfList.Get("key").Value(),
								"num": topAttSouLocInfList.Get("num").Value(),
							}
						},
					),
					"top_abnormal_urls_info": schemas.SliceToList(repConInfo.Get("top_abnormal_urls_info"),
						func(topAbnormalUrlsInfo gjson.Result) any {
							return map[string]any{
								"abnormal_502_info_list": w.setRcitauiail502(topAbnormalUrlsInfo),
								"abnormal_500_info_list": w.setRcitauiail500(topAbnormalUrlsInfo),
								"abnormal_404_info_list": w.setRcitauiail404(topAbnormalUrlsInfo),
							}
						},
					),
					"overview_statistics_list_info": schemas.SliceToList(repConInfo.Get("overview_statistics_list_info"),
						func(oveStaLisInfo gjson.Result) any {
							return map[string]any{
								"key":         oveStaLisInfo.Get("key").Value(),
								"num":         oveStaLisInfo.Get("num").Value(),
								"top_domains": w.setRcioslitd(oveStaLisInfo),
							}
						},
					),
				}
			},
		)),
		d.Set("create_time", body.Get("create_time").Value()),
	)
	return mErr.ErrorOrNil()
}

func (*SecurityReportDSWrapper) setRcirsilt(reqStaInfList gjson.Result) any {
	return schemas.SliceToList(reqStaInfList.Get("timeline"), func(timeline gjson.Result) any {
		return map[string]any{
			"time": timeline.Get("time").Value(),
			"num":  timeline.Get("num").Value(),
		}
	})
}

func (*SecurityReportDSWrapper) setRcibsiail(banStaInfo gjson.Result) any {
	return schemas.SliceToList(banStaInfo.Get("average_info_list"), func(averageInfoList gjson.Result) any {
		return map[string]any{
			"key": averageInfoList.Get("key").Value(),
			"timeline": schemas.SliceToList(averageInfoList.Get("timeline"),
				func(timeline gjson.Result) any {
					return map[string]any{
						"num":  timeline.Get("num").Value(),
						"time": timeline.Get("time").Value(),
					}
				},
			),
		}
	})
}

func (*SecurityReportDSWrapper) setRcibsipil(banStaInfo gjson.Result) any {
	return schemas.SliceToList(banStaInfo.Get("peak_info_list"), func(peakInfoList gjson.Result) any {
		return map[string]any{
			"key": peakInfoList.Get("key").Value(),
			"timeline": schemas.SliceToList(peakInfoList.Get("timeline"),
				func(timeline gjson.Result) any {
					return map[string]any{
						"time": timeline.Get("time").Value(),
						"num":  timeline.Get("num").Value(),
					}
				},
			),
		}
	})
}

func (*SecurityReportDSWrapper) setRcircsirswil(resCodStaInfo gjson.Result) any {
	return schemas.SliceToList(resCodStaInfo.Get("response_source_waf_info_list"), func(resSouWafInfList gjson.Result) any {
		return map[string]any{
			"key": resSouWafInfList.Get("key").Value(),
			"timeline": schemas.SliceToList(resSouWafInfList.Get("timeline"),
				func(timeline gjson.Result) any {
					return map[string]any{
						"time": timeline.Get("time").Value(),
						"num":  timeline.Get("num").Value(),
					}
				},
			),
		}
	})
}

func (*SecurityReportDSWrapper) setRcircsirsuil(resCodStaInfo gjson.Result) any {
	return schemas.SliceToList(resCodStaInfo.Get("response_source_upstream_info_list"), func(resSouUpsInfList gjson.Result) any {
		return map[string]any{
			"key": resSouUpsInfList.Get("key").Value(),
			"timeline": schemas.SliceToList(resSouUpsInfList.Get("timeline"),
				func(timeline gjson.Result) any {
					return map[string]any{
						"time": timeline.Get("time").Value(),
						"num":  timeline.Get("num").Value(),
					}
				},
			),
		}
	})
}

func (*SecurityReportDSWrapper) setRciqsiail(qpsStatisticsInfo gjson.Result) any {
	return schemas.SliceToList(qpsStatisticsInfo.Get("average_info_list"), func(averageInfoList gjson.Result) any {
		return map[string]any{
			"key": averageInfoList.Get("key").Value(),
			"timeline": schemas.SliceToList(averageInfoList.Get("timeline"),
				func(timeline gjson.Result) any {
					return map[string]any{
						"time": timeline.Get("time").Value(),
						"num":  timeline.Get("num").Value(),
					}
				},
			),
		}
	})
}

func (*SecurityReportDSWrapper) setRciqsipil(qpsStatisticsInfo gjson.Result) any {
	return schemas.SliceToList(qpsStatisticsInfo.Get("peak_info_list"), func(peakInfoList gjson.Result) any {
		return map[string]any{
			"key": peakInfoList.Get("key").Value(),
			"timeline": schemas.SliceToList(peakInfoList.Get("timeline"),
				func(timeline gjson.Result) any {
					return map[string]any{
						"time": timeline.Get("time").Value(),
						"num":  timeline.Get("num").Value(),
					}
				},
			),
		}
	})
}

func (*SecurityReportDSWrapper) setRcitauiail502(topAbnormalUrlsInfo gjson.Result) any {
	return schemas.SliceToList(topAbnormalUrlsInfo.Get("abnormal_502_info_list"), func(abnormal502InfoList gjson.Result) any {
		return map[string]any{
			"key":  abnormal502InfoList.Get("key").Value(),
			"num":  abnormal502InfoList.Get("num").Value(),
			"host": abnormal502InfoList.Get("host").Value(),
		}
	})
}

func (*SecurityReportDSWrapper) setRcitauiail500(topAbnormalUrlsInfo gjson.Result) any {
	return schemas.SliceToList(topAbnormalUrlsInfo.Get("abnormal_500_info_list"), func(abnormal500InfoList gjson.Result) any {
		return map[string]any{
			"host": abnormal500InfoList.Get("host").Value(),
			"key":  abnormal500InfoList.Get("key").Value(),
			"num":  abnormal500InfoList.Get("num").Value(),
		}
	})
}

func (*SecurityReportDSWrapper) setRcitauiail404(topAbnormalUrlsInfo gjson.Result) any {
	return schemas.SliceToList(topAbnormalUrlsInfo.Get("abnormal_404_info_list"), func(abnormal404InfoList gjson.Result) any {
		return map[string]any{
			"key":  abnormal404InfoList.Get("key").Value(),
			"num":  abnormal404InfoList.Get("num").Value(),
			"host": abnormal404InfoList.Get("host").Value(),
		}
	})
}

func (*SecurityReportDSWrapper) setRcioslitd(oveStaLisInfo gjson.Result) any {
	return schemas.SliceToList(oveStaLisInfo.Get("top_domains"), func(topDomains gjson.Result) any {
		return map[string]any{
			"num":  topDomains.Get("num").Value(),
			"host": topDomains.Get("host").Value(),
		}
	})
}
